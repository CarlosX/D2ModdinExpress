// Generated by CoffeeScript 1.7.1
(function() {
  "use strict";
  var app;

  window.readysound = new buzz.sound("http://static.d2modd.in/d2moddin/match_ready.ogg");

  window.invitesound = new buzz.sound("http://hydra-media.cursecdn.com/dota2.gamepedia.com/3/31/Drag_underattack_02.mp3");

  app = angular.module("d2mp", ["ngRoute", "d2mp.controllers", "d2mp.filters", "d2mp.services", "d2mp.directives", 'angulartics', 'angulartics.google.analytics', 'ngAnimate', 'angular-loading-bar', 'ngSanitize', 'ngResource', 'ng-context-menu', 'ui.bootstrap']).config([
    "$routeProvider", "$locationProvider", "$sceDelegateProvider", function($routeProvider, $locationProvider, $sceDelegateProvider) {
      $sceDelegateProvider.resourceUrlWhitelist(["**"]);
      $routeProvider.when("/", {
        templateUrl: "partials/home",
        controller: "HomeCtrl"
      });
      $routeProvider.when("/about", {
        templateUrl: "partials/about",
        controller: "AboutCtrl"
      });

      /*$routeProvider.when "/lobbies/:modname?",
        templateUrl: "partials/lobbylist"
        controller: "LobbyListCtrl"
       */
      $routeProvider.when("/mods", {
        templateUrl: "partials/mods",
        controller: "ModsCtrl"
      });
      $routeProvider.when("/mods/:modname", {
        templateUrl: "partials/moddetail",
        controller: "ModDetailCtrl"
      });

      /*
      $routeProvider.when "/install/:modname",
        templateUrl: "partials/installmod"
        controller: "InstallModCtrl"
      
      $routeProvider.when "/newlobby",
        templateUrl: "/partials/newlobby"
        controller: "CreateLobbyCtrl"
      
      $routeProvider.when "/lobby/:lobbyid",
        templateUrl: "/partials/lobby"
        controller: "LobbyCtrl"
      
      $routeProvider.when '/setup',
        templateUrl: '/partials/setup'
        controller: 'LoadTestCtrl'
      
      $routeProvider.when '/dotest',
        templateUrl: '/partials/dotest'
        controller: 'DoTestCtrl'
      
      $routeProvider.when '/leaderboard',
        templateUrl: '/partials/leaderboard'
        controller: 'LeaderboardCtrl'
      
      $routeProvider.when '/leaderboards',
        redirectTo: "/leaderboard"
      
      $routeProvider.when '/matchmake',
        templateUrl: '/partials/matchmake'
        controller: 'MatchmakeCtrl'
      
      $routeProvider.when '/ranked',
        templateUrl: '/partials/ranked'
        controller: 'RankedCtrl'
      
      $routeProvider.when '/results/:page',
        templateUrl: '/partials/results'
        controller: 'MatchHistoryCtrl'
        reloadOnSearch: false
      
      $routeProvider.when '/result/:match_id',
        templateUrl: '/partials/result'
        controller: 'ResultCtrl'
      
      $routeProvider.when '/results',
        redirectTo: '/results/1'
       */
      $routeProvider.otherwise({
        redirectTo: "/"
      });
      return $locationProvider.html5Mode(true);
    }
  ]).run([
    "$rootScope", "$lobbyService", "$forceLobbyPage", "$notService", "safeApply", "$route", "$location", "$handleInvites", (function(_this) {
      return function($rootScope, $lobbyService, $forceLobbyPage, $notService, safeApply, $route, $location, $handleInvites) {
        var updateMods;
        $rootScope.mods = [];
        $rootScope.locationPath = $location.path;
        $location.path = function(path, reload) {
          var lastRoute, un;
          if (reload === false) {
            lastRoute = $route.current;
            un = $rootScope.$on('$locationChangeSuccess', function() {
              $route.current = lastRoute;
              return un();
            });
          }
          return $rootScope.locationPath.apply($location, [path]);
        };
        $rootScope.totalPlayerCount = function(lobby) {
          var plyr, _i, _j, _len, _len1, _ref, _ref1;
          lobby.count = 0;
          _ref = lobby.dire;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            plyr = _ref[_i];
            if (plyr != null) {
              lobby.count += 1;
            }
          }
          _ref1 = lobby.radiant;
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            plyr = _ref1[_j];
            if (plyr != null) {
              lobby.count += 1;
            }
          }
          return lobby.count;
        };
        $rootScope.launchManager = function() {
          window.open("https://s3-us-west-2.amazonaws.com/d2mpclient/D2MPLauncher.exe");
          return $.pnotify({
            title: "Download Started",
            text: "Run the launcher (downloading now) to start joining lobbies.",
            type: "info",
            delay: 3000,
            closer: false,
            sticker: true
          });
        };
        $rootScope.GAMESTATE = {
          Init: 0,
          WaitLoad: 1,
          HeroSelect: 2,
          StratTime: 3,
          PreGame: 4,
          Playing: 5,
          PostGame: 6,
          Disconnect: 7
        };
        $rootScope.GAMESTATEK = _.invert($rootScope.GAMESTATE);
        $rootScope.REGIONS = {
          UNKNOWN: 0,
          NA: 1,
          EU: 2
        };
        $rootScope.REGIONSK = _.invert($rootScope.REGIONS);
        $rootScope.REGIONSH = {
          0: "All Regions",
          1: "North America",
          2: "Europe"
        };
        $rootScope.playReadySound = _.debounce(function() {
          return window.readysound.play();
        }, 3000, true);
        $rootScope.LOBBYTYPES = {
          NORMAL: 0,
          PLAYERTEST: 1,
          MATCHMAKING: 2
        };
        $notService.fetch();
        updateMods = function() {
          return $.getJSON("/data/mods", function(data) {
            return safeApply($rootScope, function() {
              $rootScope.mods = data;
              return $rootScope.$broadcast("mods:downloaded", data);
            });
          });
        };
        $rootScope.$on("mods:updated", function() {
          return updateMods();
        });
        return updateMods();
      };
    })(this)
  ]);

  return;

}).call(this);
